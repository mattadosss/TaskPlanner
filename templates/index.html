<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="../static/style.css">
</head>

<body>
<main>
    <h1>Tasks</h1>
    <input type="button" value="refresh" id="refreshButton">
    <a href="/get_task">get task per ID</a>
    <br></br>
    <div id="tasks"></div>
</main>

</body>
<script>
    // fetch("https://jsonplaceholder.typicode.com/posts").then(response => response.json()).then();

    document.addEventListener('DOMContentLoaded', async () => {

        const taskdiv = document.getElementById('tasks')
        const refreshButton = document.getElementById('refreshButton')


        function renderTaskList(tasks) {
            taskdiv.replaceChildren();  // Clear the container

            tasks.forEach(task => {
                console.log(task);

                const taskContainer = document.createElement('div');
                taskContainer.classList.add('task');

                taskContainer.style.cursor = 'pointer';
                taskContainer.onclick = () => {
                    loadoneTask(task.Task_ID);
                };

                const title = document.createElement('h2');
                title.innerText = task.Titel;

                const status = document.createElement('p');
                status.innerText = `Erledigt: ${task.erledigt ? 'Ja' : 'Nein'}`;

                const description = document.createElement('p');
                description.innerText = `Beschreibung: ${task.Beschreibung}`;

                const datetime = document.createElement('p');
                datetime.innerText = `Datum & Uhrzeit: ${task.DatumUhrzeit}`;

                taskContainer.appendChild(title);
                taskContainer.appendChild(status);
                taskContainer.appendChild(description);
                taskContainer.appendChild(datetime);

                taskdiv.appendChild(taskContainer);
            });
        }


        async function loadBlogPost() {
            const url = "/api_get_tasks";
            let result = await fetch(url);
            let task = await result.json();
            renderTaskList(task);
        }

        async function loadoneTask(id) {
            const url = `/api_get_task?id=${id}`;
            console.log(url)
            let result = await fetch(url);
            let task = await result.json();
            console.log(task)
            renderTaskList([task]);
        }

        loadBlogPost();
        refreshButton.addEventListener('click', loadBlogPost)
    });


</script>
</html>
</html>