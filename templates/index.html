<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Task Planner</title>
    <link rel="stylesheet" href="../static/style.css">
</head>

<body>
<main>
    <h1>Tasks</h1>
    <input type="button" value="refresh" id="refreshButton">
    <a href="/get_task">get task per Title</a>
    <a href="/create_task">create task</a>
    <a href="/update_task">update task</a>
    <input type="button" value="order by date" id="datebutton">
    <input type="button" value="undone Tasks" id="undone">
    <br></br>
    <div id="tasks"></div>
</main>

</body>
<script>
    // fetch("https://jsonplaceholder.typicode.com/posts").then(response => response.json()).then();

    document.addEventListener('DOMContentLoaded', async () => {

        const taskdiv = document.getElementById('tasks')
        const refreshButton = document.getElementById('refreshButton')
        const datebutton = document.getElementById("datebutton")
        const undone = document.getElementById("undone")

        function renderTaskList(tasks) {
            taskdiv.replaceChildren();  // Clear the container

            tasks.forEach(task => {
                console.log(task);

                const taskContainer = document.createElement('div');
                taskContainer.classList.add('task');

                //taskContainer.style.cursor = 'pointer';
                //taskContainer.onclick = () => {
                  //  loadoneTask(task.Task_ID);
                //};

                const title = document.createElement('h2');
                title.innerText = task.Titel;

                const status = document.createElement('p');
                status.innerText = `Erledigt: ${task.erledigt ? 'Ja' : 'Nein'}`;

                const description = document.createElement('p');
                description.innerText = `Beschreibung: ${task.Beschreibung}`;

                const datetime = document.createElement('p');
                datetime.innerText = `Datum & Uhrzeit: ${task.DatumUhrzeit}`;

                const deleteButton = document.createElement("button");
                deleteButton.innerText = "Delete Task";

                deleteButton.onclick = async () => {
                    const url = `/api_delete_task?id=${task.Task_ID}`;
                    try {
                        const response = await fetch(url, {method: 'DELETE'});
                        if (response.ok) {
                            console.log("Task deleted");
                            loadBlogPost();  // Refresh the task list, assuming this function exists
                        } else {
                            console.error("Failed to delete task");
                        }
                    } catch (error) {
                        console.error("Error:", error);
                    }
                };
                const updateButton = document.createElement("button");
                updateButton.innerText = "update Task";

                updateButton.onclick = async () => {
                    sessionStorage.setItem("Task_to_update_id", task.Task_ID)
                    window.location.href = "/update_task"
                };


                taskContainer.appendChild(title);
                taskContainer.appendChild(status);
                taskContainer.appendChild(description);
                taskContainer.appendChild(datetime);
                taskContainer.appendChild(deleteButton)
                taskContainer.appendChild(updateButton)

                taskdiv.appendChild(taskContainer);
            });
        }


        async function loadBlogPost() {
            const url = "/api_get_tasks";
            let result = await fetch(url);
            let task = await result.json();
            console.log(task)
            renderTaskList(task);
        }

        async function taskBydate() {
            const url = "/api_get_tasks_by_date";
            let result = await fetch(url);
            let task = await result.json();
            console.log(task)
            renderTaskList(task);
        }


        async function undone_tasks() {
            const url = `/api_get_undone_tasks`;
            console.log(url)
            let result = await fetch(url);
            let task = await result.json();
            console.log(task)
            renderTaskList(task);
        }

        loadBlogPost();
        refreshButton.addEventListener('click', loadBlogPost)
        datebutton.addEventListener("click", taskBydate)
        undone.addEventListener("click", undone_tasks)
    });


</script>
</html>
</html>